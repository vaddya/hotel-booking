\include{settings}

\begin{document}

\include{titlepage}

\tableofcontents
\newpage

\section{Цель работы}

Познакомиться с основами проектирования схемы БД, языком описания сущностей и ограничений БД SQL-DDL.

\section{Программа работы}

\begin{enumerate}
	\item Самостоятельное изучение SQL-DDL.
	\item Создание скрипта БД в соответствии с согласованной схемой. Должны присутствовать первичные и внешние ключи, ограничения на диапазоны значений. Демонстрация скрипта преподавателю. 
	\item Создание скрипта, заполняющего все таблицы БД данными.
	\item Выполнение SQL-запросов, изменяющих схему созданной БД по заданию преподавателя. Демонстрация их работы преподавателю.
\end{enumerate}

\section{Теоретическая информация}

\textbf{Язык SQL} (Structured Query Language) -- язык структурированных запросов. Он позволяет формировать весьма сложные запросы к базам данных. В SQL определены два подмножества языка:
\begin{itemize}
	\item \textbf{SQL-DDL} (Data Definition Language) -- язык определения структур и ограничений целостности баз данных. Сюда относятся команды создания и удаления баз данных; создания, изменения и удаления таблиц; управления пользователями и т.д.
	\item \textbf{SQL-DML} (Data Manipulation Language) -- язык манипулирования данными: добавление, изменение, удаление и извлечение данных, управления транзакциями. Функции SQL-DML определяются первым словом в предложении (часто называемом запросом), которое является глаголом: \code{SELECT} (<<выбрать>>), \code{INSERT} (<<вставить>>), \code{UPDATE} (<<обновить>>), и \code{DELETE} (<<удалить>>). 
\end{itemize}

\section{Выполнение работы}

\subsection{Структура базы данных}

\begin{figure}[H]
	\centering
	\includegraphics[width=\linewidth]{../../lab1/pics/scheme}
	\caption{Структура базы данных}
\end{figure}

\subsection{Скрипт создания структуры базы данных}

\lstinputlisting{../../migrations/V1__create.sql}

\subsection{Скрипт заполнения таблиц тестовыми данными}

\lstinputlisting{insert.sql}

\subsection{Изменение структуры базы данных}

По заданию преподавателя схема БД была изменена для удовлетворения следующим требованиям:
\begin{itemize}
	\item Добавить связь со странами и городами
	\item Добавить учет бонусов и штрафов с учетом условий бронирования
\end{itemize}

Были добавлены следующие таблицы:
\begin{itemize}
	\item \code{country} -- хранит 3-символьный код \code{id} и название \code{name} страны.
	
	\item \code{city} -- хранит название \code{name} и 3-символьный код страны \code{country_id}.
	
	\item \code{bonus_penalty} -- хранит условие предоставление бонуса или причину штрафа \code{condition} и соответствующий денежный бонус/штраф \code{price}.
	
	\item \code{bonus_penalty_reservation} -- соотносит бронирование \code{reservation_id} с бонусами/штрафами \code{bonus_penalty_id}.
\end{itemize}

\begin{figure}[H]
	\centering
	\includegraphics[width=\linewidth]{alter}
	\caption{Структура базы данных}
\end{figure}

Скрипт создания дополнительных таблиц, внесения в них тестовых данных, и изменения существующих:

\lstinputlisting{../../migrations/V2__alter.sql}

\section{Выводы}

В ходе выполнения данной работы были изучены основы создания скриптов на языке SQL. С помощью SQL-DDL описаны структуры разрабатываемой схемы базы данных. С использованием SQL-DML созданные структуры заполнены тестовыми данными. Изучен синтаксис обновления структуры существующей таблицы.

\end{document}
